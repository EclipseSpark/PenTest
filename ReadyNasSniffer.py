#!/usr/bin/env python

import requests
import sys
import fileinput
from optparse import OptionParser
parser = OptionParser()
parser.add_option("-f", "--file", dest="filename",
                  help="Read from a FILE", metavar="FILE")
parser.add_option("-H", "--host", dest="host",
                  help="Single IP/Domain", metavar="HOST")
(options, args) = parser.parse_args()
#print(options.filename)
host = []
#print(options.host)
if (sys.argv[1] == "-f") or (sys.argv[1] == "--file"):
	filehosts = options.filename
	for line in fileinput.input(files = filehosts):
		host.append(line.rstrip())
else:
	host.append(options.host)
	

try:
	for nas in host:
		r = requests.get('http://' + nas)
	
		# {Versions < 4.2.24}
		if '<meta http-equiv="refresh" content="0; url=/shares/">' and "Copyright 2007, NETGEAR" in r.text:
			print("\n\t ----------------------------START Host:\t"+ nas+"------------------------------\n\n")
			print(r.text)
			#print(r.status_code)
			print(r.headers)
			print(r.headers['last-modified'])
			print("\n\t ----------------------------END Host:\t"+ nas+"------------------------------\n\n")
	
		else:
			print('Patched')
except ValueError:
	print("Oops!  That was no valid number.  Try again...")
